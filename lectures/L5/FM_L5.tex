%%% License: Creative Commons Attribution Share Alike 4.0 (see https://creativecommons.org/licenses/by-sa/4.0/)
%%% Slides are based heavily on earlier versions of this course taught by Jesper Rudiger.

\documentclass[english,10pt
%,handout
,aspectratio=169
]{beamer}
\input{../FM_preamble.tex}



\title{Financial Markets Microstructure \\ Lecture 7}

\subtitle{Depth determinants \\ %Empirics of illiquidity\\
	Chapter 4 of FPR}

\author{Egor Starkov}

\date{K{\o}benhavns Unversitet \\
	Spring 2025}


\begin{document}
	
\AtBeginSection[]{
	\frame<beamer>{
		\frametitle{This lecture:}
		\tableofcontents[currentsection,currentsubsection]
}}

\frame[plain]{\titlepage}


\begin{frame}{Previously on...}
	\begin{enumerate}
		\item The spread is not only driven by adverse selection: order costs and inventory risk have an effect as well
		%\item However, we would expect the dynamic effect of these three different mechanisms to be different
		%\begin{itemize}
		%	\item Order costs: only short-run effect 
		%	\item Inventory risk: medium-run effect, but should be zero in the long run
		%	\item Adverse selection: long-run effect 
		%\end{itemize}
	\end{enumerate}
\end{frame}


\begin{frame}{Homework from last time}
	We said today that inventory risk is priced when the dealer is risk-averse. Risk-aversion is one explanation, but other factors can also contribute to inventory risk.
	The two following cases explore this issue:
	\begin{itemize}
		\item A big trader was punted off the Nordic power market after failing to meet margin calls (two articles on absalon).
		\begin{itemize}
			\item How does inventory risk manifest in this story?
			\item Explain why such inventory risk can be priced even by risk-neutral agents.
		\end{itemize}
		\item Negative oil futures prices were registered last year (blog post on absalon or \href{https://streetwiseprofessor.com/wti-wtf/}{\uline{here}}).
		\begin{itemize}
			\item Why did it happen? How do negative prices make sense?
			\item How does inventory risk manifest in this story?
			\item Explain why such inventory risk can be priced even by risk-neutral agents.
		\end{itemize}
	\end{itemize}
\end{frame}


\begin{frame}<handout:0>{Inventory concerns more broadly}
	\begin{itemize}
		\item We have discussed how dealers' risk-aversion can drive the spread, depth, and make prices deviate from the efficient level
		\item Two comments on that, from the cases you read:
		\item \textbf{Point 1}: risk-aversion in markets may stem from market risks, rather than inherent risk-aversion in preferences.
		\begin{itemize}
			\item \underline{Standard story}: $u(w)$ is concave in future wealth (e.g., MeanVar/CARA/CRRA prefs), and $w \sim z \cdot v + ...$ (position $\times$ asset value), hence $u(v)$ is concave in $v$, more so for higher $z$.
			\item \underline{Alternative}: $u(w)$ is linear (risk-neutrality), but low $v$ creates higher risk of margin calls, which are costly: $w \sim z \cdot \left( v - c \cdot \mathbb{I} \{ v < \underline{v}, z>0 \} \right) + ...$ $\Rightarrow$ $u(v)$ is again concave in $v$.
			\item Either story leads to dealer's inventory affecting their willingness to buy/sell
		\end{itemize}
	\end{itemize}
\end{frame}


\begin{frame}<handout:0>{Inventory concerns more broadly}
	\begin{itemize}
		\item \textbf{Point 2}: what if traders in the market are risk-averse, and not just the dealer?
		\begin{itemize}
			\item If traders provide liquidity (e.g., we are in LOB market and not a dealer market) -- same inventory risks
			\item If general market populace is risk-averse: in a similar way, traders' valuation for the asset would depend on how far their current position is from their ideal position.
			\item So if there is some aggregate imbalance -- i.e., current aggregate holdings (many traders long on oil futures) are different from aggregated ideal positions (everyone wants to dump their futures) -- then market price might deviate from the fundamental value
			\item (Although the question to ask is: why did such discrepancy in positions arise in the first place, and is it by itself informative about the fundamentals)
		\end{itemize}
	\end{itemize}
\end{frame}


\begin{frame}{Today}
	\begin{itemize}
		\item \textbf{Trade size}
		\begin{itemize}
			\item How does trade size affect prices? 
			\item I.e., what determines market \structure{depth}?
			\item (Spoiler: mostly the same factors as with liquidity)
			\item Will look at Kyle (1985) model -- an alternative to GM that allows flexible trade size
		\end{itemize}
	\end{itemize}
\end{frame}



%\section{Depth determinants and Kyle model}

\begin{frame}{Prices and trade size}
	\begin{itemize}
		\item How does trade size affect prices? 
		\begin{itemize}
			\item Spread larger for large trades, price moves further from efficient level
			\item I.e., market has limited \structure{depth}
		\end{itemize}
		\item Why?
		\pause
		\begin{enumerate}[<+->]
			\item \alert{Adverse selection}\visible<handout:0>{: larger trades indicate more/stronger news}
			\item \alert{Inventory risk}\visible<handout:0>{: large positions are risky and take dealers longer to unwind, hence require larger premiums}
			\item \structure{Imperfectly competitive dealers}\visible<handout:0>{: market power allows dealers to set wider spread and steeper or flatter pricing schedules}
			\item \structure{Order processing costs}\visible<handout:0>{: may increase or decrease (per stock) in total order size}
		\end{enumerate}
	\end{itemize}
\end{frame}


\begin{frame}{Kyle model}
	\begin{itemize}
		\item We will look at Kyle (1985) model which links market depth to adverse selection
		\item It can be extended to accomodate imperfect competition among dealers (see 4.2.4) and inventory risk (4.3)
		\begin{itemize}
			\item the inventory risk version is broadly similar to the Stoll model that we skipped
			\item trading costs are very difficult to incorporate in this model
		\end{itemize}
	\end{itemize}
\end{frame}


\begin{frame}{Setup: Broad strokes}
	\begin{itemize}
		\item A \alert{call auction}; orders come from a ``large'' speculator and a population of noise traders; market cleared by a dealer.
		\item \structure{Speculator/informed trader}: has private information
		\begin{itemize}
			\item Trades using a `large' speculative market order
			\item Strategically moderates order size to reduce price impact
			\item `Hides' behind noise traders who submit a random size order
		\end{itemize}
		\item Representative \structure{market maker (MM)/dealer}
		\begin{itemize}
			\item Risk neutral and competitive (zero profits)
			\item Clears orders in \textit{batches} (as opposed to one-by-one in Glosten \& Milgrom)
			\item Cannot distinguish speculative orders from noise orders in a batch
		\end{itemize}
	\end{itemize}
\end{frame}


\begin{frame}{Setup}
\begin{itemize}
	\item \structure{Asset}: Trade in one risky asset with value  $v \sim \mathcal{N}(\mu, \sigma^2_v)$
	\item \structure{Speculator}: Observes true value $v$ (perfect information)
	\begin{itemize}
		\item Places market order $x$
		\item If the order clears at price $p$: gain is $x(v-p)$
		\item Does \alert{not know} $p$ when choosing $x$: maximizes \emph{expected} gain (risk neutral) given $\mathbb{E}[p|x]$
	\end{itemize}
	\item \structure{Noise trader}: Has random demand $u \sim \mathcal{N}(0, \sigma^2_u)$
	\item \structure{MM}: Submits a supply schedule of $(q,p)$ combinations:
	\begin{itemize}
		\item ``If the order imbalance is $q=x+u$, I will absorb it at price $p$''
		\item Observes aggregate flow $q=x+u$, but not $x$ and $u$
		\item Competitive (zero profit): $p = \mathbb{E}[v|q]$
	\end{itemize}
	\item \structure{Assumption}: $u$ and $v$ are jointly normal and independent
	%\item \structure{Method}: Postulate linear strategy-- then check that this is equilibrium
\end{itemize}
\end{frame}


\begin{frame}{Setup: Timing}
	\begin{itemize}
		\item To be explicit, the timing is as follows:
	\end{itemize}
	\begin{enumerate}
		\item at the beginning of the period:
		\begin{itemize}
			\item speculator chooses order size $x$
			\item noise traders submit their order $u$
			\item dealer submits price schedule $(q,p)$
		\end{itemize}
		\item then market price $p(q)$ is determined given total order $q=x+u$
		\item at the end of the period payoffs are realized
	\end{enumerate}
\end{frame}


\begin{frame}{Linear equilibrium: outline}
\begin{itemize}
	\item The equilibrium is described by the speculator's strategy $x(v)$ and the dealer's pricing schedule $p(q)$.
	\pause
	\item Look for equilibrium where speculator's strategy is linear: \alert{$x=\beta(v-\mu)$}
	\begin{itemize}
		\item Note: $\beta$ is endogenously determined by the equilibrium, we'll derive it
		\item $\beta>0$ measures speculator \textit{aggression}
	\end{itemize}
	\item MM's pricing is driven by the zero-profit condition: $p=\mathbb{E}[v|q]$
	\begin{itemize}
		\item In eqm, MM knows the speculator's strategy ($x=\beta(v-\mu)$)
		\item So MM observes $q=x+u=\beta(v-\mu)+u$, and wants to \alert{estimate $v$}
		%\item Intuitively, \alert{$\mathbb{E}[v|q] = \mu + \lambda  q$}, where $\lambda $ is the regression coefficient $\mathbb{C}(v,q)/\mathbb{V}(q)$, and recall that $\mu=\mathbb{E}[v]$. (This is derived formally in the following slides.)
	\end{itemize}
	%\item Since $p=\mathbb{E}[v|q]$, we can use the conditional expectation to get a price impact equation 
	%\[
	%p=\mu+\lambda q.
	%\]
	%Here $1/\lambda$ would be a measure of market depth
\end{itemize}
\end{frame}


\begin{frame}{Aside: Hitchhiker's guide to normal updating}
	Updating normal beliefs with normal signals might seem daunting at first, but here's how it works.
	\pause 
	\begin{itemize}
		\item Suppose there is some uncertain \structure<1>{variable $x$} and our prior belief is that \structure<1>{$x \sim \mathcal{N}(\mu_x, \sigma^2_x)$}
		\item This prior belief is said to have \alert<1>{precision $\tau_x \equiv \frac{1}{\sigma^2_x}$}.
		\pause 
		\item Suppose we get \structure<2>{signal $y$} about $x$ with \alert<2>{precision $\tau_\epsilon$}. 
		\\I.e., we observe \structure<2>{$y = x + \epsilon$}, where $\epsilon \sim \mathcal{N}\left( 0, \frac{1}{\tau_\epsilon} \right)$ (so $\tau_\epsilon \equiv \frac{1}{\sigma^2_\epsilon}$).
		\pause 
		\item Then our \structure{posterior belief} about $x$ has \alert{precision $\tau_{x|\epsilon} = \tau_x + \tau_\epsilon$}, and the posterior mean weighs the prior mean $\mu_x$ and the signal $y$ according to their precisions: 
		\begin{align*}
			x|y &\sim \mathcal{N} \left( \alert{\frac{\tau_x}{\tau_x + \tau_\epsilon}} \mu_x + \alert{\frac{\tau_\epsilon}{\tau_x + \tau_\epsilon}} y ,\; \frac{1}{\tau_{x|\epsilon}} \right)
		\end{align*}
		(you can verify this by directly calculating the conditional pdf)
	\end{itemize}
\end{frame}


\begin{frame}{Deriving the distribution of $v|q$}
	In our case:
	\begin{itemize}
		\item $v \sim \mathcal{N}(\mu, \sigma^2_v)$,
		\item $q=\beta(v-\mu) + u$, where $u \sim \mathcal{N}(0, \sigma^2_u)$, $u \perp v$.
		\pause \medskip 
		\item So the prior precision (of the belief about $v$) is $\tau_v \equiv \visible<handout:0>{\frac{1}{\sigma^2_v}}$, 
		\item and the signal is $\tilde{q} \equiv \visible<handout:0>{\frac{q}{\beta} + \mu = v + \frac{u}{\beta}}$, which has precision $\tau_{\tilde{q}} = \visible<handout:0>{\frac{\beta^2}{\sigma^2_u}}$
		\pause \medskip 
		\item Then 
		\begin{align*}
			v|q & \sim \mathcal{N} \left( \frac{\tau_v}{\tau_v + \tau_{\tilde{q}}} \mu + \frac{\tau_{\tilde{q}}}{\tau_v + \tau_{\tilde{q}}} \tilde{q} ,\; \frac{1}{\tau_v + \tau_{\tilde{q}}} \right)
			\\
			& \sim \mathcal{N} \left( \visible<handout:0>{\mu + \frac{\beta \sigma^2_v}{\beta^2 \sigma^2_v + \sigma^2_u} q,\; \left( \frac{1}{\sigma^2_v}+\frac{\beta^2}{\sigma^2_u} \right)^{-1} } \right)
		\end{align*}
	\end{itemize}
\end{frame}


\begin{frame}{Dealer's strategy}
	%\[
	%	\mathbb{E}[v|q] = \mathbb{E}[v] + \frac{\mathbb{C}(v,q)}{\mathbb{V}(q)} (q-\mathbb{E}[q]) = \mu + \frac{\mathbb{C}(v,q)}{\mathbb{V}(q)} q,
	%\]
	Going back to the zero profit condition: 
	%\alert{$p = \mathbb{E}[v|q]$}, hence
	\begin{align*}\\
		p &= \mathbb{E}[v|q]
		\\ \iff
		p &= \mu + \frac{\beta \sigma^2_v}{\beta^2 \sigma^2_v + \sigma^2_u} q
		\\ \iff 
		p &= \mu + \lambda q,
		\\
		\text{where } \lambda &\equiv \frac{\beta \sigma^2_v}{\beta^2 \sigma^2_v + \sigma^2_u} 
		\; \left( = \frac{\mathbb{C}(v,q)}{\mathbb{V}(q)} \right)
	\end{align*}
	Here $\lambda$ is the \structure{price impact} coefficient.
	\\
	Conversely, $1/\lambda$ is a measure of \alert{market depth}
\end{frame}


\begin{frame}{Speculator's strategy}
	Back to the speculator's problem.
	The speculator takes for granted the MM's pricing rule $p=\mu+\lambda q$
	\begin{itemize}
		\item Speculator's \structure{profit} is $\Pi(x) = x(v-p) = x(v-\mu-\lambda x - \lambda u)$
		\item \structure{Expected profit} is $ \mathbb{E}[\Pi(x)] = x(v-\mu-\lambda x)$, since $\mathbb{E}[u]=0$
		\item Speculator chooses $x$ to maximize $\mathbb{E}[\Pi(x)]$. Using the first-order condition:
		\begin{align*}
			v-\mu -2\lambda x &=0
			\\
			\Rightarrow \alert{x} &\alert{=\beta(v-\mu),}
			\\
			\text{where } \alert{\beta} &\alert{=1/(2\lambda)}
		\end{align*}
		\item Confirmed that it is optimal for the speculator to use a linear strategy!
		\item Note analogy to monopoly problem: \visible<handout:0|2->{\structure{trade-off b/w trading more and trading at better price}}
	\end{itemize}
\end{frame}


\begin{frame}{Closing the equilibrium}
	\begin{itemize}
		\item Finally, `match' the coefficients:
		\[
			\frac{1}{2\beta}=\lambda = \frac{\beta \sigma^2_v}{\beta^2 \sigma^2_v + \sigma^2_u}
		\]
		i.e. $\beta^2 \sigma^2_v + \sigma^2_u = 2 \beta^2 \sigma^2_v$ which yields
		\[
				\alert{ \beta = \frac{\sigma_u}{\sigma_v}}\text{ and } \alert{ \lambda = \frac{\sigma_v}{2\sigma_u}}.
		\]
		\item Thus: the strategies are optimal given the prices, and the prices optimal given the strategies $\rightarrow $ \textbf{equilibrium}
	\end{itemize}
\end{frame}


\begin{frame}{Equilibrium properties}
	\[
		\alert{ \beta = \frac{\sigma_u}{\sigma_v}}\text{ and } \alert{ \lambda = \frac{\sigma_v}{2\sigma_u}}.
	\]
	\begin{itemize}
		\item Speculator is more \textbf{aggressive} ($\beta$ higher) when:
		\begin{enumerate}
			\item The informational advantage $\sigma_v$ is smaller (why?)
			\item There's more noise $\sigma_u$ to hide behind (why?)
		\end{enumerate}
		\pause
		\item \textbf{Market depth}:
		\[
			\frac{1}{\lambda} = 2\beta = 2 \frac{\sigma_u}{\sigma_v}
		\]
		The market is deeper when there is less insider trading and more noise trading
	\end{itemize}
\end{frame}


\begin{frame}{Equilibrium properties}
	\begin{itemize}
		\item Insider's a priori (before observing $v$) \textbf{expected gain}:
		\begin{align*}
		\mathbb{E}[x(v-\mu-\lambda x)] 
		& =\mathbb{E} \left[ \beta(v-\mu)\left(v-\mu-\frac{v-\mu}{2}\right) \right] \\
		&=\beta\frac{ \sigma^2_v}{2}=\frac{\sigma_v \sigma_u}{2}
		\end{align*}
		Comment: speculator expects a positive profit (could abstain). Competitive risk-neutral MM earns zero profits. Noise traders lose. Same as in GM.
		\pause
		\item Market maker's \textbf{posterior variance} of $v$ is
		\[
		\mathbb{V}(v|q) = \frac{1}{1/\sigma^2_v + \beta^2/\sigma^2_u} = \frac{\sigma^2_v}{2}
		\]
		Exactly half the prior variance: \structure{Insider reveals half his information}
	\end{itemize}
\end{frame}


\begin{frame}{Kyle's model: summary}
	\begin{itemize}
		\item \textbf{Dealer/market maker model}: Competitive, risk-neutral (zero profit) dealer chooses a supply schedule
		\item \textbf{Informed trader}: Observes signal about asset value and places market order
		\item \textbf{Market clearing}: \structure{Auction}, dealer observes only total demand (informed + noise), total demand clears
		\item \textbf{Insights}: informed trading is a factor generating limited market depth, insider always reveals half his information
		\item \textbf{Advantage}: Richer trading opportunities, trader not price-taker
		\item \textbf{Shortcomings}: Still no resale
	\end{itemize}
\end{frame}


\begin{frame}{Kyle with inventory risk I}
\begin{itemize}
	\item Now let's look at how market maker's \alert{inventory risk} can lead to limited depth.
	\item Assume \structure{no informed trading}: $x = 0$.
	\item Asset value $v \sim \mathcal{N}(\mu, \sigma^2_v)$
	\item Market maker has mean-variance preferences over their next-period wealth:
	\[
	U(w_{t+1})=\mathbb{E}[w_{t+1}] - \frac{\rho}{2} \mathbb{V}(w_{t+1}),
	\]
	where $w$ is composed of cash and asset holdings: $w_{t+1} = (z_t - q_t) v + q_t p_t$
	\item MM's initial asset position is $z_t$ (initial cash is irrelevant, ignore it).
\end{itemize}
\end{frame}


\begin{frame}{Kyle with inventory risk II}
\begin{itemize}
	\item To get the pricing schedule, follow the competitive logic:
	\begin{itemize}
		\item The market-maker takes some market price $p$ as given, chooses how much $q(p)$ to sell at this price:
		\begin{align*}
			\max_q \left\{ \underbrace{(z_t-q)\mathbb{E}[v] + qp}_{\mathbb{E}[w_{t+1}]} - \underbrace{\frac{\rho}{2} (z_t-q)^2 \mathbb{V}(v) }_{ \mathbb{V}(w_{t+1})} \right\}
		\end{align*}
		\item FOC: $p - \mu + \rho (z_t-q) \sigma_v^2 = 0 \iff \structure{q(p) =} z_t + \frac{p - \mu}{\rho \sigma_v^2}$
	\end{itemize}
	\item For market to clear, need $q(p) = u = q$ (dealer's supply = total traders' market order), so inverting the pricing schedule we get: 
	$$p(q) = \mu + \rho \sigma_v^2 (q - z_t).$$
\end{itemize}
\end{frame}


\begin{frame}{Kyle with inventory risk III}
$$p(q) = \mu + \rho \sigma_v^2 (q - z_t)$$
Takeaways:
\begin{enumerate}
	\item Depth (dictated by the dealer's willingness to trade at a given price) is limited 
	\item This is despite traders still being completely price-insensitive in this model!
	\item Price impact depends on asset riskiness $\sigma_v^2$ and MM's risk aversion $\rho$.
	\item Midquote depends on $z_t$
\end{enumerate}
So really, all the same stuff as in GM with inventory risk.
\\ The book also looks at versions with many MMs with heterogeneous $\rho$s, and many imperfectly competitive MMs.
\end{frame}


\begin{frame}{Extensions}
	Other extensions are possible:
	\begin{enumerate}
		\item \textbf{Dynamics}
		\begin{itemize}
			\item In a fully dynamic model, the insider reveals less than half of the information in each period. Why?
			\pause \visible<handout:0>{\structure{In order to better benefit from informational advantage}}
			\pause
			\item In the limit where trade is continuous over $[0,T]$, then $\mathbb{V}(v|q_0, ..., q_t) \simeq (T-t)\frac{\sigma^2_v}{T}$: variance decreases linearly in time. 
			\pause \structure{Model of how to split a large trade over time}
		\end{itemize}
		\pause
		\item \textbf{More insiders}
		\begin{itemize}
			\item More insiders are more competitive; more aggressive
			\item The market is more liquid and more information revealed
			\item In dynamic model with several insiders: rush to trade on common information from the beginning
		\end{itemize}
	\end{enumerate}
\end{frame}


\begin{frame}{}
	\begin{enumerate}
		\setcounter{enumi}{2}
		\item \textbf{Imperfect market maker competition} (Cournot style)
		\begin{itemize}
			\item Finite number of market makers, $k=1,..., K$
			\item Market maker $k$ supplies $y^k=\phi(p-\mu)$
			\item Market clears at price $p$ with $\sum y^k = q$
			\item Strategic market maker takes into account effect of orders on profits
			\item Now: $p=\mu+\lambda q$ where $\lambda = \alpha (K-1)/(K-2) > \alpha$. 
			%Why? 
			%\pause \visible<handout:0>{\structure{Increasing price sensitivity reduces $k$'s amount traded, but raises market price, the former outweighs.}}
		\end{itemize}
		\pause
		%\item \textbf{Risk averse market makers}
		%\begin{itemize}
		%	\item Similar to Stoll (1978) from textbook and GM with risk-aversion that we covered; same takeaways
		%	\item See the following slides
		%	%\item See textbook for ver with no asymmetric information. Can add that and imperfect competition.
		%	%\item Allows for imperfect competition: depth is a factor of $(K-1)/(K-2)$ of what we found for Stoll
		%\end{itemize}
		%\pause
		\item \textbf{Trading costs}
		\begin{itemize}
			\item Trivial in GM. Very difficult here, both technically and conceptually.
			\item Don't know how many trades there are, don't know the total volume (not $q$ -- some noise traders' orders could've cancelled each other out)
			\item Even taking costs as a linear function of order imbalance $|q|$ makes things difficult
		\end{itemize}
	\end{enumerate}
\end{frame}


\begin{frame}{Homework}
	\begin{enumerate}
		\item We will talk about empirical estimation of factors of illiquidity next time (ch.5) and begin talking about LOB markets (without dealers; ch.6)
		\item Solve ex 3 in ch.4 (p.159): Kyle's model with competition among speculators.
	\end{enumerate}
\end{frame}

\end{document} 