%%% License: Creative Commons Attribution Share Alike 4.0 (see https://creativecommons.org/licenses/by-sa/4.0/)
%%% Slides are based heavily on earlier versions of this course taught by Jesper Rudiger.

\documentclass[english,10pt
%,handout
,aspectratio=169
]{beamer}
\input{../FM_preamble.tex}



\title{Financial Markets Microstructure \\ Lecture 9}

\subtitle{Limit order book, part 1\\
	Chapter 6.1-6.2 of FPR}

\author{Egor Starkov}

\date{K{\o}benhavns Unversitet \\
	Spring 2025}




\begin{document}
\AtBeginSection[]{
\frame<beamer>{
\frametitle{This lecture:}
\tableofcontents[currentsection,currentsubsection]
}}
\frame[plain]{\titlepage}

%\section{Revision and readings}

\begin{frame}{Last time}
	\begin{itemize}
		\item The Kyle model helps us analyze market depth:
		\begin{itemize}
			\item Hence, it tells us something about how adverse selection causes spread to vary with trade size
			\item The model has batch clearing instead of the single-unit market of GM
		\end{itemize}
		\item We can use insights from theory to estimate the importance of different components of the spread
		\begin{itemize}
			\item Perhaps surprisingly, order costs are by far the largest cost (but estimated on major stocks)
			\item Around 19\% of trading is informed
			\item Adverse selection is stronger for less liquid/small-cap stocks
		\end{itemize}
	\end{itemize}
\end{frame}


\begin{frame}{Homework}
	\begin{itemize}
		\item Read the Economist article on the corporate bond market. 
		\\
		Discuss the following questions:
		\begin{enumerate}
			\item How does corporate bond market liquidity differ from the stock market liquidity? Why?
			\item Why do investors' liquidity expectations matter?
			\item How do investors form their expectations of liquidity?
			\item Can we \emph{measure investors' expectations} of liquidity?
		\end{enumerate}
	\end{itemize}
\end{frame}


%\begin{frame}{Exercise}
%	% the conclusions from last time may lead us into thinking that informed trading is no big deal. These articles aim to argue the converse
%	\begin{itemize}
%		\item I uploaded two articles from the Economist, March 7, 2014, both on potential manipulation of prices
%		\item Consider these two issues:
%		\begin{itemize}
%			\item What motivates a trader to manipulate an asset's price? 
%			\item Is manipulation easier in a very liquid or a very illiquid market?
%			% less liquid requires less effort to manipulate the price, but it looks less credible
%		\end{itemize}
%	\end{itemize}
%\end{frame}



\section{LOB Markets: Introduction}

\begin{frame}<handout:0>{Introduction}
	\begin{itemize}
		\item \textcolor<2>{gray}{Note: this and the next two lectures draw a bit from the \cite{parlour_limit_2008} survey in addition to the textbook.}
		\item \textcolor<2>{gray}{Note: the notation will also be a bit different from the book to stay closer to what we used before}
		
		\pause \bigskip 
		
		\item There's a reason that first models of financial markets (GM and Kyle) explored dealer markets...
	\end{itemize}
\end{frame}


\begin{frame}<handout:0>
	\centering
	\includegraphics[scale=0.5]{pics/mkt20}
	
	Financial market in 1985
\end{frame}


\begin{frame}<handout:0>
	\centering
	\includegraphics[scale=0.19]{pics/mkt21}
	
	Financial market today
\end{frame}


\begin{frame}{LOB Markets: Liquidity Demand}
	\begin{itemize}
		\item Most markets are order-driven these days
		\begin{itemize}
			\item Some exchanges combine LOBs and dealers
		\end{itemize}
		\item There is also conceptual convenience in starting with dealer models...
		\item ``Dealer'' is an abstraction of the ``market'':
		\begin{center}
			\structure{Trader interacting with the dealer} $\approx$ \alert{Trader interacting with the market}
		\end{center}
		So for a \textbf{liquidity demander} who submits market orders, it does not really matter who to trade against.
	\end{itemize}
\end{frame}


\begin{frame}{LOB Markets: Liquidity Providers}
	But \alert{liquidity provision} works quite differently in LOB markets:
	\begin{enumerate}
		\item Traders have a choice between \structure{demanding and supplying liquidity} (market vs limit orders) -- so LO should be no worse than MO for trading
		\item LO give better prices but suffer from execution risk
		\item Conditional on electing to trade via LO, traders face a \structure{different informational environment} from the dealer (dealer knows more about what's happening in a market)
		\item Also there's discriminatory pricing: LO execute each at their posted price, while a dealer can clear everything at uniform price.
	\end{enumerate}
	We look at the two latter issues today; two former next time.
\end{frame}


\begin{frame}{LOB Markets: Modelling Issues}
	A limit order is $(t,x,p)$: submission time $t$, quantity $x$, price $p$.
	
	Modelling LOBs properly is very difficult, many factors to account for:
	\begin{enumerate}
		\item Traders' \structure{action set} is large: submit buy/sell LO/MO, how much, choose price if LO
		\item \structure{Dynamics} is relevant: choose when to submit, when to cancel/resubmit (since LO might not execute)
		\item \structure{State} of LOB is rich: trader's choice depends on other LOs in the book (though not all of them might be observable)
		\item Private information affects not just valuation, but \structure{expectations} about LOB evolution...
	\end{enumerate}
	So we'll look at very simple models that explore different slices of this problem.
\end{frame}


%\begin{frame}{Introduction}
%	\begin{itemize}
%		\item \structure{Price discrimination}:  LOB has discriminatory pricing of larger orders
%		\begin{itemize}
%			\item Difference to Kyle's (auction) model: in LOB, total order size is not observed, you only know that your limit order has been `hit'
%			\item \cite{glosten_is_1994} provides a Glosten-Milgrom style model of the price schedule offered (i.e., how much volume supplied at the limit prices)
%		\end{itemize}
%		\item \structure{Ticks}: Often prices are discrete and must lie at a tick (e.g. at NYSE, ticks are multiples of 1 cent) --  tick size is the increment btw prices:
%		\begin{itemize}
%			\item Prioritized limit orders become profitable when there are ticks 
%			(since no `marginal undercutting')
%			\item We will analyze the effects of changing ticks, priority rules
%		\end{itemize}
%		\item \structure{Interpretation}: One way of thinking of an LOB is that dealers post limit orders, as in the GM model
%	\end{itemize}
%\end{frame}



\section{Static Analysis: Glosten Model (continuous)}

\begin{frame}{\cite{glosten_is_1994} model}
	\begin{itemize}
		\item Begin by looking at \cite{glosten_is_1994} model
		\begin{itemize}
			\item (Probably) the first model of LOB markets
			\item Does not capture all of traders' choices
			\item Consider it to be ``one step towards LOB markets from Kyle model''.
		\end{itemize}
		\item Questions simple:
		\begin{itemize}
			\item What drives the prices? Are they efficient?
			\item How are prices different from dealer markets?
			\item How is LOB depth determined?
		\end{itemize}
	\end{itemize}
\end{frame}


\begin{frame}{Continuous model: Limit order book (asset supply)}
\begin{itemize}
	\item \textbf{Single asset}: Unknown value $v$ with cdf $G(v)$
	\item \textbf{Limit order book}: 
	\begin{itemize}
		\item Focus on the ask side of the market (limit orders to sell vs market order to buy)
		\item Assume a continuum of competitive limit traders, each submits an infinitesimally small order
		\item Let $p(q) \equiv$ price of $q$th unit (increasing in $q$ due to price priority)
		\item A market buy order of size $q$ will `walk up the book' until the final bit of it is cleared at price $p(q)$
		\item The entire payment for buying volume $q$ is then $P(q) \equiv \int_0^q p(\tilde{q}) \, d\tilde{q}$.
		\item The average price per unit is $\bar{p}(q) \equiv \frac{P(q)}{q}$  -- the (inverse) \structure{supply curve}
	\end{itemize}
	\pause
	\item Bliz quiz: in the Kyle model, did the dealer announce \alert{marginal price $p(q)$} or \structure{average price $\bar{p}(q)$} schedule?
\end{itemize}
\end{frame}


\begin{frame}{Continuous model: Market orders (asset demand)}
	\begin{itemize}
		\item \textbf{Single market[-order] trader} per period (as in GM/Kyle)
		\item Abstract view: assume some total utility $U(x|v)$ from buying $x$ units, increasing in $v$, increasing and concave in $x$, and $\frac{\partial^2 U(x|v)}{\partial x \partial v} > 0$.
		\item Trader then \alert{demands quantity $x$} that solves
		\begin{align*}
			\max_{x} \left\{ U(x|v) - P(x) \right\}
			&&
			\Rightarrow
			&&
			\structure{U'(x|v) = P'(x)} = p(x)
		\end{align*}\vspace{-0.6cm}
		\begin{itemize}
			\item If trader was perfectly informed, then $U(x|v) = v \cdot x$
			\item Assume again some superposition of informed and uninformed traders, $U(x|v)$ is average over types
		\end{itemize}
		\item Abusing notation, $U'(x|v)$ is average/representative trader's marginal valuation for $x$th unit of the asset
		\item The cross-derivative implies that $\mathbb{E}[v|U'(x|v) = p]$ for a given $x$ is strictly increasing in $p$
		\begin{itemize}
			\item the fact that the trader stopped at a higher marginal price $p$ suggests higher $v$
		\end{itemize}
	\end{itemize}
\end{frame}


\begin{frame}{Continuous model: Market makers}
\begin{itemize}	
	\item \textbf{Limit[-order] traders} are competitive, post limit orders
	\begin{itemize}
		\item Think of a continuum of traders, each posts a limit order for one (infinitesimally small) unit of the asset
	\end{itemize}
	%\item Equilibrium/market-clearing condition: $x=q$ (demand=supply)
	\item Limit price $p(q)$ quoted for the $q$-th unit is relevant (=is traded against) iff $$x \geq q \iff U'(x) \geq p(q)$$
	\item Hence, if supply is competitive then in equilibrium,
	\[
	\structure{p(q) = \mathbb{E}[v| x \geq q]}
	\]
	(as before - price of trade equals the expected value of the traded asset. The conditioning event is the interesting part)
\end{itemize}
\end{frame}


\begin{frame}{Continuous model: Equilibrium}
The assumed correlation of $v$ and $x$ implies that
\begin{align}
	p(q) = \mathbb{E}[v|x \geq q] > \mathbb{E}[v|x = q]
\end{align}
(to compare, in the Kyle model we had \only<1>{\alert{what pricing schedule?}}
\pause 
$\bar{p}(q) = \mathbb{E}[v|x = q]$)
\pause
\begin{block}{Implications}
	\begin{itemize}
		\item Thus, market makers (ex post) profit on the sale of the last units
		\item At small realized trades, $q \simeq 0$, MM always profit
		\item Even with continuous prices, there is a non-zero \structure{inside spread} between ask and bid prices as the order size goes to zero (contrast with Kyle)
		% The reason is that in the limit order market, liquidity suppliers cannot make their quotes contingent on the total size of market orders. As a result, the limit orders at the top of the book are more exposed to adverse selection.
		\item After a trade of size $q$, new expected asset value is below $p(q)$. \pause 
		
		\structure{New asset valuation is $\mu = \mathbb{E}[v|x=q]<\mathbb{E}[v|x \geq q]=p(q)$}. Often new limit orders will be posted below $p(q)$ -- price reversal.
	\end{itemize}
\end{block}
\end{frame}


\begin{frame}{Conclusion}
	\begin{itemize}
		\item First look into LOB markets using \cite{glosten_is_1994}.
		\item Limit traders act in the same capacity as the dealer did before
		\begin{itemize}
			\item but face different \alert{informational environment}
			\item so act differently
			\item which leads to different market outcomes
		\end{itemize}
		\item Competitive limit traders may get positive or negative profit ex post, depending on the order they trade against, but get zero profit on average.
	\end{itemize}
\end{frame}


\begin{frame}{Next time}
	\begin{itemize}
		\item What happens if we restrict prices to discrete ticks?
		\item Many aspects of market design (tick size, priority rules) are all double-edged swords, swing them carefully
		\item (maybe) Dynamic analysis: traders can choose between limit and market orders
	\end{itemize}
\end{frame}


%\begin{frame}{Homework}
%	\begin{itemize}
%		\item Thinking in the framework of the discrete model: suppose tick size is actually zero; quotes can be placed in a continuous price space. Suppose that there is price priority. What then is the role of time priority, so that first-come quotes at identical prices are served first?
%		\item If you could choose between trading at discriminatory prices in a limit order book, or to reveal your order size to a dealer, what would influence your choice?
%		% ex1 is on informed trading
%		% ex5 is on make-or-take choice 
%		\item Solve exercise 1 on pages 232-233 (ch.6) in the textbook. Note that you need to use Bayes' rule to assess the conditional distribution over $v$ given a market order of size $q$
%		%\item Solve exercise 5 on page 235 in the textbook on the effect of fees charged for limit orders and market orders
%	\end{itemize}
%\end{frame}





\appendix
\begin{frame}<handout:0>[allowframebreaks]{References}
	\bibliography{../teaching}
	\bibliographystyle{abbrvnat}
\end{frame}




\end{document} 